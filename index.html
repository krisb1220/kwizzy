<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="icon" href="https://glitch.com/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kwizzy!!</title>

   <!-- Import the webpage's stylesheet -->
  <link rel="stylesheet" href="src/style.css" type="text/css" /> 
</head>

<body>
  <h1> Kwizzy by Krissy</h1>
  <p>This is an example of a basic authentication REST API. There have been no security considerations
    aside from hashing the password on the server. <br> This system will eventually be used in a full stack project, Kwizzy. 
    It is planned on being a drag/drop/WYSIWYG quiz/form builder.
  </p>
  <form class="authentication" method="post" action="/signup" id="signup">
    <h1 id="result">Login or sign up</h1>
    Credentials:
    <input id="email" name="email" placeholder="krisb1220@gmail.com" required="required" type="email" />
    <input id="password" name="password" placeholder="password" required="required" type="password" />

    <button type="submit" id="sub">Submit</button>
  </form>
  <input type="checkbox" id="login-type" />Signup not login?
  <div id="menu"></div>
  <main>
    <div class="container grid kit">
      <button class="item kit-tool" id="rad" data-tooltype="radio" draggable="true"><p class="label">Radio</p></button>
      <button class="item kit-tool" data-tooltype="checkbox" draggable="true"><p class="label">Checkbox</p></button>
      <button class="item kit-tool" data-tooltype="textarea" draggable="true"><p class="label">Text</p></button>
    </div>

    <div class="container main-area">
        <form id="builder">
            form
        </form>
        <button type="submit" id="save-kwizzy">Save Kwizzy</button>
    </div>
  </main>
</body>


<script>
    let global = {
        num_elements: 0,
        elements:[],
        saved: true,
        userData: {},
        isLoggedIn: false
    }
</script>


<script id="builder-logic">
    console.log("new")
    let kitButtons = document.querySelectorAll(".kit-tool");
    console.log(kitButtons);

    kitButtons.forEach((item)=>{
        console.log(item);
        console.log(item.innerHTML);
        item.addEventListener("click", (e)=>{
            console.log()
            let inputID = "input-" + global.num_elements; 
            let containerID = "input-container" + global.num_elements; 


            let inputElement = document.createElement("input");
            inputElement.type = item.dataset.tooltype;
            inputElement.id =  inputID;
            inputElement.name = inputID;

            let containerElement = document.createElement("div");
            containerElement.classList.add("inner-input");
            containerElement.id =  containerID;

            let labelElement = document.createElement("label");
            labelElement.innerText = `New ${item.dataset.tooltype} Element`.toLocaleUpperCase();
            labelElement.setAttribute("for", inputID); // Associate the label with the input
            labelElement.contentEditable = "true"; // Make the label editable
            labelElement.classList.add("input-label")

            containerElement.appendChild(labelElement);
            containerElement.appendChild(inputElement);
            global.elements.push(containerElement);
            // containerElement.appendChild(inputElement);

            global.saved = false;
            document.querySelector("#builder").appendChild(containerElement);

        })
    })

</script>


<script id="save-kwizzy">
    document.querySelector("#save-kwizzy").addEventListener("click", (e) => {
        e.preventDefault();
        if (!global.saved && global.isLoggedIn) {
            const data = document.querySelector("#builder").innerHTML;
            global.saved = true;
            console.log("save");
            fetch("http://localhost:3000/entries?action=new", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ postBody: data, title: "A kwizzy made at " + Date.now(), email:global.userData.email})
            })
                .then(response => {
                    console.log(response.status);
                    return response;
                })
                .then(response => response.json())
                .then((body) => {
                    console.log("Kwizzy saved!");
                });
        } else {
            alert("Kwizzy already saved!");
        }
    });
</script>



<script id="login-form">
    let formData = new FormData(document.forms.signup)
  
    document.querySelector("#signup").addEventListener("change", (e) => {
      formData = new FormData(document.forms.signup)
    })
  
    document.querySelector("#signup").addEventListener("submit", (e) => {
      e.preventDefault();

      let isChecked = document.querySelector("#login-type").checked
      let prod = "http://localhost:3000";

      if(document.location.href == prod) {
        global.url = !document.querySelector("#login-type").checked ? "/login" : "/signup";
      } else {
        global.url = !document.querySelector("#login-type").checked ? `${prod}/login` : `${prod}/signup`;
      }

      data = {
        email: formData.get("email"),
        password: formData.get("password")
      }
  
      fetch(global.url, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(data) }).then(response => console.log(response.status) || response)
        .then(response => response.json())
        .then((body) => {
            document.querySelector("#result").innerText = body.message;
            global.userData = body._doc;
            console.log(global.userData);
            global.isLoggedIn = true;
            let kwizzyList = document.createElement("select");
            kwizzyList.setAttribute("id", "kwizzy-list")
            global.userData.entries.forEach((entry)=>{
                let entrySelection = document.createElement("option")
                entrySelection.setAttribute("value", entry._id)
                entrySelection.innerText = entry.title;
                kwizzyList.appendChild(entrySelection);
            });

            // document.getElementById("kwizzy-list").addEventListener("onchange", (e)=>{
            //     console.log("kwizzy selected")
            //     console.log(e);
            // })

            console.log(kwizzyList)
            document.getElementById("menu").appendChild(kwizzyList);
        })
    });
  </script>




<div id="attributions">
    <p class="name">Created by Kris Baillargeon</p>
    <a href="https://github.com/krisb1220" class="github">Visit me on Github</a>
</div>


</html>


